<div class="player-wrapper" [class.fullscreen]="isFullscreen()" (mousemove)="onMouseMove()">
  <button class="close-btn" (click)="onClose()" aria-label="Fermer">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </button>

  <video
    #videoElement
    class="video-element"
    (timeupdate)="onTimeUpdate()"
    (loadedmetadata)="onLoadedMetadata()"
    (play)="onPlay()"
    (pause)="onPause()"
    (waiting)="onWaiting()"
    (canplay)="onCanPlay()"
    (error)="onVideoError()"
    (click)="togglePlay()"
    playsinline
  ></video>

  @if (isBuffering() && !hasError()) {
    <div class="buffering-overlay">
      <div class="spinner"></div>
    </div>
  }

  @if (hasError()) {
    <div class="error-overlay">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="48"
        height="48"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <p>Impossible de lire cette vidéo</p>
    </div>
  }

  <div class="controls" [class.visible]="showControls()">
    @if (title()) {
      <div class="title-bar">
        <span class="video-title">{{ title() }}</span>
      </div>
    }

    <div class="progress-container">
      <div #progressBar class="progress-bar" (click)="seekTo($event, progressBar)">
        <div class="progress-played" [style.width.%]="progress()"></div>
      </div>
    </div>

    <div class="controls-row">
      <div class="controls-left">
        <button class="control-btn" (click)="togglePlay()" aria-label="Lecture/Pause">
          @if (isPlaying()) {
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <rect x="6" y="4" width="4" height="16"></rect>
              <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
          } @else {
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="currentColor"
            >
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
          }
        </button>

        <div class="volume-control">
          <button class="control-btn" (click)="toggleMute()" aria-label="Muet">
            @if (isMuted() || volume() === 0) {
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <line x1="23" y1="9" x2="17" y2="15"></line>
                <line x1="17" y1="9" x2="23" y2="15"></line>
              </svg>
            } @else {
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
              </svg>
            }
          </button>
          <input
            type="range"
            class="volume-slider"
            min="0"
            max="1"
            step="0.1"
            [value]="volume()"
            (input)="onVolumeChange($event)"
          />
        </div>

        <span class="time-display">{{ formattedCurrentTime() }} / {{ formattedDuration() }}</span>
      </div>

      <div class="controls-right">
        <button class="control-btn" (click)="toggleFullscreen()" aria-label="Plein écran">
          @if (isFullscreen()) {
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"></path>
            </svg>
          } @else {
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
            </svg>
          }
        </button>
      </div>
    </div>
  </div>
</div>
